<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} + ' - E-Commerce Platform'">Order Details - E-Commerce Platform</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" th:href="@{/}">
                <i class="fas fa-shopping-cart"></i> E-Commerce
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/products}">Products</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/cart}">
                            <i class="fas fa-shopping-cart"></i> Cart
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" th:href="@{/orders}">Orders</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" data-toggle="dropdown">
                            <i class="fas fa-user"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" th:href="@{/orders}">My Orders</a>
                            <div class="dropdown-divider"></div>
                            <form th:action="@{/logout}" method="post" class="px-2">
                                <button type="submit" class="dropdown-item">Logout</button>
                            </form>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="bg-light">
        <div class="container">
            <ol class="breadcrumb mb-0 py-2">
                <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
                <li class="breadcrumb-item"><a th:href="@{/orders}">Orders</a></li>
                <li class="breadcrumb-item active" th:text="'Order #' + ${order.orderId}">Order Details</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Alert Messages -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
            <span th:text="${successMessage}"></span>
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>

        <div class="row">
            <!-- Order Info -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4 class="mb-0"><i class="fas fa-file-invoice"></i> Order #<span th:text="${order.orderId}">123</span></h4>
                        <div>
                            <span class="badge badge-lg" th:classappend="${order.status.name() == 'PENDING'} ? 'badge-warning' :
                                                               ${order.status.name() == 'CONFIRMED'} ? 'badge-info' :
                                                               ${order.status.name() == 'SHIPPED'} ? 'badge-primary' :
                                                               ${order.status.name() == 'DELIVERED'} ? 'badge-success' : 'badge-danger'"
                                  th:text="${order.status}">Status</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <p class="mb-1"><strong>Order Date:</strong></p>
                                <p th:text="${#temporals.format(order.createdAt, 'MMMM dd, yyyy HH:mm')}">Date</p>
                            </div>
                            <div class="col-sm-6">
                                <p class="mb-1"><strong>Payment Status:</strong></p>
                                <p>
                                    <span class="badge" th:classappend="${order.paymentStatus.name() == 'COMPLETED'} ? 'badge-success' :
                                                                         ${order.paymentStatus.name() == 'PENDING'} ? 'badge-warning' : 'badge-danger'"
                                          th:text="${order.paymentStatus}">Payment</span>
                                </p>
                            </div>
                        </div>

                        <h5><i class="fas fa-box"></i> Order Items</h5>
                        <hr>
                        <table class="table">
                            <thead class="thead-light">
                                <tr>
                                    <th style="width: 80px;">Image</th>
                                    <th>Product</th>
                                    <th class="text-center">Price</th>
                                    <th class="text-center">Qty</th>
                                    <th class="text-right">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${order.items}">
                                    <td>
                                        <img th:src="${item.product.imageUrl != null ? item.product.imageUrl : 'https://via.placeholder.com/60x60?text=No+Image'}"
                                             class="img-thumbnail" style="max-width: 60px;" th:alt="${item.product.name}">
                                    </td>
                                    <td class="align-middle">
                                        <a th:href="@{/products/{id}(id=${item.product.productId})}"
                                           th:text="${item.product.name}" class="text-dark">Product Name</a>
                                    </td>
                                    <td class="align-middle text-center" th:text="${#numbers.formatCurrency(item.price)}">$0.00</td>
                                    <td class="align-middle text-center" th:text="${item.quantity}">1</td>
                                    <td class="align-middle text-right font-weight-bold" th:text="${#numbers.formatCurrency(item.subtotal)}">$0.00</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="table-light">
                                    <td colspan="4" class="text-right"><strong>Total:</strong></td>
                                    <td class="text-right"><strong class="h5 text-primary" th:text="${#numbers.formatCurrency(order.totalAmount)}">$0.00</strong></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Side Panel -->
            <div class="col-lg-4">
                <!-- Shipping Address -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-map-marker-alt"></i> Shipping Address</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-0" th:text="${order.shippingAddress}">Address</p>
                    </div>
                </div>

                <!-- Order Status Timeline -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-tasks"></i> Order Status</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled order-timeline">
                            <li th:class="${order.status.name() == 'PENDING' or order.status.name() == 'CONFIRMED' or order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'completed' : ''">
                                <i class="fas fa-clock"></i> Order Placed
                            </li>
                            <li th:class="${order.status.name() == 'CONFIRMED' or order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'completed' : ''">
                                <i class="fas fa-check-circle"></i> Confirmed
                            </li>
                            <li th:class="${order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'completed' : ''">
                                <i class="fas fa-shipping-fast"></i> Shipped
                            </li>
                            <li th:class="${order.status.name() == 'DELIVERED'} ? 'completed' : ''">
                                <i class="fas fa-home"></i> Delivered
                            </li>
                        </ul>
                        <div th:if="${order.status.name() == 'CANCELLED'}" class="alert alert-danger mb-0">
                            <i class="fas fa-times-circle"></i> This order has been cancelled.
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card">
                    <div class="card-body">
                        <a th:href="@{/orders}" class="btn btn-outline-primary btn-block">
                            <i class="fas fa-arrow-left"></i> Back to Orders
                        </a>
                        <form th:action="@{/orders/{id}/cancel(id=${order.orderId})}" method="post"
                              th:if="${order.status.name() == 'PENDING' or order.status.name() == 'CONFIRMED'}">
                            <button type="submit" class="btn btn-outline-danger btn-block mt-2"
                                    onclick="return confirm('Are you sure you want to cancel this order?')">
                                <i class="fas fa-times"></i> Cancel Order
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <small>&copy; 2019 E-Commerce Platform. All rights reserved.</small>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
